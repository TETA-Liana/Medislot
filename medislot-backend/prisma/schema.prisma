generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum UserRole {
  PATIENT
  DOCTOR
  ADMIN
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}

enum AppointmentStatus {
  UPCOMING
  COMPLETED
  CANCELLED
  PENDING_CONFIRMATION
}

enum EmailStatus {
  PENDING
  SENT
  FAILED
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  password      String
  role          UserRole  @default(PATIENT)
  isActive      Boolean   @default(true)
  
  // Profile
  firstName     String?
  lastName      String?
  phone         String?
  avatar        String?
  
  // Timestamps
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  // Relationships
  patientProfile Patient?
  doctorProfile  Doctor?
  refreshTokens  RefreshToken[]
  sentAppointments Appointment[] @relation("PatientAppointments")
  receivedAppointments Appointment[] @relation("DoctorAppointments")
  
  @@index([email])
  @@index([role])
}

model RefreshToken {
  id          String   @id @default(uuid())
  token       String   @unique
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt   DateTime
  createdAt   DateTime @default(now())
  
  @@index([token])
  @@index([userId])
}

model Patient {
  id            String   @id @default(uuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Medical Info
  dateOfBirth   DateTime?
  bloodGroup    String?
  allergies     String?
  
  // Timestamps
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Relationships
  appointments  Appointment[] @relation("PatientAppointments")
}

model Doctor {
  id              String   @id @default(uuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Professional Info
  specialty       String
  licenseNumber   String   @unique
  experienceYears Int      @default(0)
  consultationFee Float    @default(0)
  bio             String?
  
  // Status
  isVerified      Boolean  @default(false)
  approvalStatus  ApprovalStatus @default(PENDING)
  
  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  // Relationships
  hospitalId      String?
  hospital        Hospital? @relation(fields: [hospitalId], references: [id])
  availabilities  DoctorAvailability[]
  appointments    Appointment[] @relation("DoctorAppointments")
  
  @@index([specialty])
  @@index([approvalStatus])
  @@index([isVerified])
}

model Hospital {
  id           String   @id @default(uuid())
  name         String
  address      String
  city         String
  contactEmail String
  contactPhone String
  logo         String?
  isActive     Boolean  @default(true)
  
  // Timestamps
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  // Relationships
  doctors      Doctor[]
  appointments Appointment[]
  
  @@index([name])
  @@index([city])
}

model DoctorAvailability {
  id          String   @id @default(uuid())
  doctorId    String
  doctor      Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade)
  
  dayOfWeek   Int      // 0-6 (Sunday-Saturday)
  startTime   String   // Format: "09:00"
  endTime     String   // Format: "17:00"
  isActive    Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([doctorId, dayOfWeek])
}

model Appointment {
  id          String   @id @default(uuid())
  
  // Relationships
  patientId   String
  patient     Patient  @relation(fields: [patientId], references: [id], onDelete: Cascade, name: "PatientAppointments")
  senderId    String?
  sender      User?    @relation("PatientAppointments", fields: [senderId], references: [id])
  doctorId    String
  doctor      Doctor   @relation(fields: [doctorId], references: [id], onDelete: Cascade, name: "DoctorAppointments")
  receiverId  String?
  receiver    User?    @relation("DoctorAppointments", fields: [receiverId], references: [id])
  hospitalId  String?
  hospital    Hospital? @relation(fields: [hospitalId], references: [id])
  
  // Appointment Details
  date        DateTime
  duration    Int      @default(30) // minutes
  status      AppointmentStatus @default(UPCOMING)
  
  // Additional Info
  notes       String?
  symptoms    String?
  cancellationReason String?
  
  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([patientId])
  @@index([doctorId])
  @@index([date])
  @@index([status])
}

model EmailLog {
  id          String   @id @default(uuid())
  to          String
  subject     String
  template    String
  status      EmailStatus @default(PENDING)
  sentAt      DateTime?
  error       String?
  
  createdAt   DateTime @default(now())
  
  @@index([to])
  @@index([status])
  @@index([createdAt])
}